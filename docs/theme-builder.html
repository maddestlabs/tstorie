<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TStorie Theme Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #00d98e;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #909090;
            margin-bottom: 30px;
        }
        
        .section {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .section h2 {
            color: #ffff00;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .color-input {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .color-input label {
            font-weight: 500;
            color: #c0c0c0;
            font-size: 0.9em;
        }
        
        .color-picker-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .color-input input[type="color"] {
            width: 60px;
            height: 40px;
            border: 2px solid #444;
            border-radius: 4px;
            cursor: pointer;
            background: transparent;
        }
        
        .color-input input[type="text"] {
            flex: 1;
            padding: 8px 12px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .color-input input[type="text"]:focus {
            outline: none;
            border-color: #00d98e;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            background: #00d98e;
            color: #001111;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #00ffaa;
        }
        
        button.secondary {
            background: #444;
            color: #e0e0e0;
        }
        
        button.secondary:hover {
            background: #555;
        }
        
        .theme-select {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        select {
            flex: 1;
            padding: 8px 12px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            cursor: pointer;
        }
        
        select:focus {
            outline: none;
            border-color: #00d98e;
        }
        
        .output {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            word-break: break-all;
            border: 1px solid #444;
        }
        
        .output.success {
            border-color: #00d98e;
        }
        
        .preview-iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #444;
            border-radius: 8px;
            background: #001111;
        }
        
        .info {
            background: #2a3a3a;
            padding: 12px;
            border-radius: 4px;
            border-left: 3px solid #00d98e;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .warning {
            background: #3a2a2a;
            border-left-color: #ff006e;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® TStorie Theme Builder</h1>
        <p class="subtitle">Create custom color themes and share them via URL</p>
        
        <!-- Built-in Themes -->
        <div class="section">
            <h2>1. Start with a Built-in Theme</h2>
            <div class="theme-select">
                <select id="builtinTheme">
                    <option value="">-- Custom --</option>
                    <option value="neotopia" selected>Neotopia</option>
                    <option value="neonopia">Neonopia</option>
                    <option value="catppuccin">Catppuccin Mocha</option>
                    <option value="nord">Nord</option>
                    <option value="dracula">Dracula</option>
                    <option value="outrun">Outrun</option>
                    <option value="alleycat">Alleycat</option>
                    <option value="terminal">Terminal</option>
                    <option value="solardark">Solarized Dark</option>
                    <option value="solarlight">Solarized Light</option>
                    <option value="coffee">Coffee</option>
                    <option value="stonegarden">Stone Garden</option>
                    <option value="wat">WAT</option>
                </select>
                <button onclick="loadBuiltinTheme()">Load Theme</button>
            </div>
        </div>
        
        <!-- Color Customization -->
        <div class="section">
            <h2>2. Customize Colors</h2>
            <div class="color-grid">
                <div class="color-input">
                    <label>Background Primary</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="bgPrimary" value="#001111">
                        <input type="text" id="bgPrimaryHex" value="001111" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                    </div>
                </div>
                
                <div class="color-input">
                    <label>Background Secondary</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="bgSecondary" value="#09343a">
                        <input type="text" id="bgSecondaryHex" value="09343a" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                    </div>
                </div>
                
                <div class="color-input">
                    <label>Foreground Primary</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="fgPrimary" value="#e0e0e0">
                        <input type="text" id="fgPrimaryHex" value="e0e0e0" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                    </div>
                </div>
                
                <div class="color-input">
                    <label>Foreground Secondary</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="fgSecondary" value="#909090">
                        <input type="text" id="fgSecondaryHex" value="909090" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                    </div>
                </div>
                
                <div class="color-input">
                    <label>Accent 1</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="accent1" value="#00d98e">
                        <input type="text" id="accent1Hex" value="00d98e" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                    </div>
                </div>
                
                <div class="color-input">
                    <label>Accent 2</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="accent2" value="#ffff00">
                        <input type="text" id="accent2Hex" value="ffff00" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                    </div>
                </div>
                
                <div class="color-input">
                    <label>Accent 3</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="accent3" value="#ff006e">
                        <input type="text" id="accent3Hex" value="ff006e" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Generate URL -->
        <div class="section">
            <h2>3. Generate & Share</h2>
            <div class="buttons">
                <button onclick="generateThemeUrl()">Generate URL</button>
                <button class="secondary" onclick="copyThemeUrl()">Copy to Clipboard</button>
                <button class="secondary" onclick="previewTheme()">Preview in TStorie</button>
            </div>
            <div id="urlOutput" class="output" style="margin-top: 15px; display: none;"></div>
        </div>
        
        <!-- Preview -->
        <div class="section">
            <h2>4. Preview</h2>
            <div class="info">
                Click "Preview in TStorie" to see your theme in action with the theme customizer demo.
            </div>
            <iframe id="preview" class="preview-iframe" style="display: none;"></iframe>
        </div>
        
        <!-- Info -->
        <div class="section">
            <h2>‚ÑπÔ∏è How It Works</h2>
            <div class="info">
                <strong>URL Format:</strong> <code>?theme=#RRGGBB#RRGGBB#RRGGBB#RRGGBB#RRGGBB#RRGGBB#RRGGBB</code>
                <br><br>
                The theme parameter contains 7 hex colors in this order:
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Background Primary (main background)</li>
                    <li>Background Secondary (panels, cards)</li>
                    <li>Foreground Primary (main text)</li>
                    <li>Foreground Secondary (muted text)</li>
                    <li>Accent 1 (headings, highlights)</li>
                    <li>Accent 2 (links, borders)</li>
                    <li>Accent 3 (emphasis, warnings)</li>
                </ol>
            </div>
            
            <div class="info warning">
                <strong>Tip:</strong> Test your theme with actual content to ensure good contrast and readability!
            </div>
        </div>
    </div>
    
    <script src="theme-builder.js"></script>
    <script>
        // Built-in theme definitions (from storie_themes.nim)
        const builtinThemes = {
            neotopia: {
                bg: "001111",
                bgAlt: "09343a",
                fg: "e0e0e0",
                fgAlt: "909090",
                accent1: "00d98e",
                accent2: "ffff00",
                accent3: "ff006e"
            },
            neonopia: {
                bg: "050000",
                bgAlt: "340905",
                fg: "a0a0a0",
                fgAlt: "6f6f6f",
                accent1: "ff2671",
                accent2: "0000ff",
                accent3: "00ff91"
            },
            catppuccin: {
                bg: "1e1e2e",
                bgAlt: "313244",
                fg: "cdd6f4",
                fgAlt: "6c7086",
                accent1: "f5c2e7",
                accent2: "89b4fa",
                accent3: "a6e3a1"
            },
            nord: {
                bg: "2e3440",
                bgAlt: "3b4252",
                fg: "eceff4",
                fgAlt: "d8dee9",
                accent1: "88c0d0",
                accent2: "81a1c1",
                accent3: "a3be8c"
            },
            dracula: {
                bg: "282a36",
                bgAlt: "44475a",
                fg: "f8f8f2",
                fgAlt: "6272a4",
                accent1: "ff79c6",
                accent2: "8be9fd",
                accent3: "50fa7b"
            },
            outrun: {
                bg: "1a0033",
                bgAlt: "2d0055",
                fg: "f0f0ff",
                fgAlt: "8b5cf6",
                accent1: "ff006e",
                accent2: "00f5ff",
                accent3: "ffbe0b"
            },
            alleycat: {
                bg: "0a0a0f",
                bgAlt: "1a1a2e",
                fg: "e0e0ff",
                fgAlt: "6b7fd7",
                accent1: "00ffff",
                accent2: "ff00ff",
                accent3: "00ff00"
            },
            terminal: {
                bg: "0a0a0a",
                bgAlt: "1a1a1a",
                fg: "00ff00",
                fgAlt: "008800",
                accent1: "00ff00",
                accent2: "00cc00",
                accent3: "00aa00"
            },
            solardark: {
                bg: "002b36",
                bgAlt: "073642",
                fg: "839496",
                fgAlt: "586e75",
                accent1: "268bd2",
                accent2: "2aa198",
                accent3: "859900"
            },
            solarlight: {
                bg: "fdf6e3",
                bgAlt: "eee8d5",
                fg: "657b83",
                fgAlt: "93a1a1",
                accent1: "268bd2",
                accent2: "2aa198",
                accent3: "859900"
            },
            coffee: {
                bg: "f2d3ac",
                bgAlt: "731425",
                fg: "260324",
                fgAlt: "bf8c6f",
                accent1: "bf3434",
                accent2: "bf8c6f",
                accent3: "f2d3ac"
            },
            stonegarden: {
                bg: "1a1d1e",
                bgAlt: "2d3032",
                fg: "e8e6e3",
                fgAlt: "989693",
                accent1: "8db88d",
                accent2: "c4a777",
                accent3: "5a7a8e"
            },
            wat: {
                bg: "ff00ff",
                bgAlt: "00ff00",
                fg: "ffff00",
                fgAlt: "ff6900",
                accent1: "00ffff",
                accent2: "ff1493",
                accent3: "7fff00"
            }
        };
        
        // Sync color picker with hex input
        function setupColorSync() {
            const colors = ['bgPrimary', 'bgSecondary', 'fgPrimary', 'fgSecondary', 'accent1', 'accent2', 'accent3'];
            
            colors.forEach(color => {
                const picker = document.getElementById(color);
                const hexInput = document.getElementById(color + 'Hex');
                
                // Picker -> Hex input
                picker.addEventListener('input', () => {
                    hexInput.value = picker.value.substring(1).toUpperCase();
                });
                
                // Hex input -> Picker
                hexInput.addEventListener('input', () => {
                    let hex = hexInput.value.replace(/[^0-9A-Fa-f]/g, '').substring(0, 6);
                    hexInput.value = hex;
                    if (hex.length === 6) {
                        picker.value = '#' + hex;
                    }
                });
            });
        }
        
        // Load a built-in theme
        function loadBuiltinTheme() {
            const select = document.getElementById('builtinTheme');
            const themeName = select.value;
            
            if (!themeName || !builtinThemes[themeName]) {
                return;
            }
            
            const theme = builtinThemes[themeName];
            
            document.getElementById('bgPrimary').value = '#' + theme.bgPrimary;
            document.getElementById('bgPrimaryHex').value = theme.bgPrimary;
            
            document.getElementById('bgSecondary').value = '#' + theme.bgSecondary;
            document.getElementById('bgSecondaryHex').value = theme.bgSecondary;
            
            document.getElementById('fgPrimary').value = '#' + theme.fgPrimary;
            document.getElementById('fgPrimaryHex').value = theme.fgPrimary;
            
            document.getElementById('fgSecondary').value = '#' + theme.fgSecondary;
            document.getElementById('fgSecondaryHex').value = theme.fgSecondary;
            
            document.getElementById('accent1').value = '#' + theme.accent1;
            document.getElementById('accent1Hex').value = theme.accent1;
            
            document.getElementById('accent2').value = '#' + theme.accent2;
            document.getElementById('accent2Hex').value = theme.accent2;
            
            document.getElementById('accent3').value = '#' + theme.accent3;
            document.getElementById('accent3Hex').value = theme.accent3;
        }
        
        // Generate theme URL
        function generateThemeUrl() {
            const colors = {
                bg: document.getElementById('bgPrimaryHex').value,
                bgAlt: document.getElementById('bgSecondaryHex').value,
                fg: document.getElementById('fgPrimaryHex').value,
                fgAlt: document.getElementById('fgSecondaryHex').value,
                accent1: document.getElementById('accent1Hex').value,
                accent2: document.getElementById('accent2Hex').value,
                accent3: document.getElementById('accent3Hex').value
            };
            
            const themeString = TStorieThemes.buildThemeString(colors);
            
            if (!themeString) {
                alert('Invalid color values! Please check your hex codes.');
                return;
            }
            
            const url = TStorieThemes.buildUrl({ 
                theme: themeString,
                content: 'demo:theme-customizer'
            });
            
            const output = document.getElementById('urlOutput');
            output.textContent = url;
            output.style.display = 'block';
            output.classList.add('success');
            
            return url;
        }
        
        // Copy URL to clipboard
        async function copyThemeUrl() {
            const url = generateThemeUrl();
            if (!url) return;
            
            try {
                await navigator.clipboard.writeText(url);
                alert('‚úì Theme URL copied to clipboard!');
            } catch (e) {
                console.error('Failed to copy:', e);
                alert('Failed to copy to clipboard. Please copy manually from the text box.');
            }
        }
        
        // Preview theme in iframe
        function previewTheme() {
            const url = generateThemeUrl();
            if (!url) return;
            
            const preview = document.getElementById('preview');
            preview.src = url;
            preview.style.display = 'block';
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            setupColorSync();
            
            // Check if theme param exists in URL and load it
            const urlParams = new URLSearchParams(window.location.search);
            const themeParam = urlParams.get('theme');
            
            if (themeParam && themeParam.startsWith('#')) {
                const theme = TStorieThemes.parseCustomTheme(themeParam);
                if (theme) {
                    document.getElementById('bgPrimaryHex').value = theme.bgPrimary;
                    document.getElementById('bgPrimary').value = '#' + theme.bgPrimary;
                    document.getElementById('bgSecondaryHex').value = theme.bgSecondary;
                    document.getElementById('bgSecondary').value = '#' + theme.bgSecondary;
                    document.getElementById('fgPrimaryHex').value = theme.fgPrimary;
                    document.getElementById('fgPrimary').value = '#' + theme.fgPrimary;
                    document.getElementById('fgSecondaryHex').value = theme.fgSecondary;
                    document.getElementById('fgSecondary').value = '#' + theme.fgSecondary;
                    document.getElementById('accent1Hex').value = theme.accent1;
                    document.getElementById('accent1').value = '#' + theme.accent1;
                    document.getElementById('accent2Hex').value = theme.accent2;
                    document.getElementById('accent2').value = '#' + theme.accent2;
                    document.getElementById('accent3Hex').value = theme.accent3;
                    document.getElementById('accent3').value = '#' + theme.accent3;
                    
                    document.getElementById('builtinTheme').value = '';
                }
            } else {
                // Load Neotopia by default
                loadBuiltinTheme();
            }
        });
    </script>
</body>
</html>
