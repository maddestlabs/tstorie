var d;d||=typeof Module != 'undefined' ? Module : {};var aa=globalThis.document?.currentScript?.src,m="",q;try{m=(new URL(".",aa)).href}catch{}q=async a=>{a=await fetch(a,{credentials:"same-origin"});if(a.ok)return a.arrayBuffer();throw Error(a.status+" : "+a.url);};var r=console.log.bind(console),t=console.error.bind(console),u,w=!1,x,y,z,A,B,C,D;
function E(){var a=F.buffer;y=new Int8Array(a);new Int16Array(a);z=new Uint8Array(a);new Uint16Array(a);A=new Int32Array(a);B=new Uint32Array(a);C=new Float32Array(a);new Float64Array(a);D=new BigInt64Array(a);new BigUint64Array(a)}function G(a){d.onAbort?.(a);a="Aborted("+a+")";t(a);w=!0;throw new WebAssembly.RuntimeError(a+". Build with -sASSERTIONS for more info.");}var H;
async function ba(a){if(!u)try{var c=await q(a);return new Uint8Array(c)}catch{}if(a==H&&u)a=new Uint8Array(u);else throw"both async and sync fetching of the wasm failed";return a}async function ca(a,c){try{var b=await ba(a);return await WebAssembly.instantiate(b,c)}catch(e){t(`failed to asynchronously prepare wasm: ${e}`),G(e)}}
async function da(a){var c=H;if(!u)try{var b=fetch(c,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(b,a)}catch(e){t(`wasm streaming compile failed: ${e}`),t("falling back to ArrayBuffer instantiation")}return ca(c,a)}class I{name="ExitStatus";constructor(a){this.message=`Program terminated with exit(${a})`;this.status=a}}
var J=a=>{for(;0<a.length;)a.shift()(d)},K=[],L=[],ea=()=>{var a=d.preRun.shift();L.push(a)},M=0,N=null,O=!0,P=0,fa=[0,31,60,91,121,152,182,213,244,274,305,335],ha=[0,31,59,90,120,151,181,212,243,273,304,334],Q={},R=a=>{if(!(a instanceof I||"unwind"==a))throw a;},S=a=>{x=a;O||0<P||(d.onExit?.(a),w=!0);throw new I(a);},ia=a=>{if(!w)try{if(a(),!(O||0<P))try{x=a=x,S(a)}catch(c){R(c)}}catch(c){R(c)}},T=(a,c,b)=>{var e=z;if(!(0<b))return 0;var f=c;b=c+b-1;for(var h=0;h<a.length;++h){var g=a.codePointAt(h);
if(127>=g){if(c>=b)break;e[c++]=g}else if(2047>=g){if(c+1>=b)break;e[c++]=192|g>>6;e[c++]=128|g&63}else if(65535>=g){if(c+2>=b)break;e[c++]=224|g>>12;e[c++]=128|g>>6&63;e[c++]=128|g&63}else{if(c+3>=b)break;e[c++]=240|g>>18;e[c++]=128|g>>12&63;e[c++]=128|g>>6&63;e[c++]=128|g&63;h++}}e[c]=0;return c-f},ja=[null,[],[]],U=globalThis.TextDecoder&&new TextDecoder,V=(a,c=0,b,e)=>{var f=c;b=f+b;if(e)e=b;else{for(;a[f]&&!(f>=b);)++f;e=f}if(16<e-c&&a.buffer&&U)return U.decode(a.subarray(c,e));for(f="";c<e;)if(b=
a[c++],b&128){var h=a[c++]&63;if(192==(b&224))f+=String.fromCharCode((b&31)<<6|h);else{var g=a[c++]&63;b=224==(b&240)?(b&15)<<12|h<<6|g:(b&7)<<18|h<<12|g<<6|a[c++]&63;65536>b?f+=String.fromCharCode(b):(b-=65536,f+=String.fromCharCode(55296|b>>10,56320|b&1023))}}else f+=String.fromCharCode(b);return f},W=a=>{for(var c=0,b=0;b<a.length;++b){var e=a.charCodeAt(b);127>=e?c++:2047>=e?c+=2:55296<=e&&57343>=e?(c+=4,++b):c+=3}return c},ma=(a,c,b,e)=>{var f={string:l=>{var n=0;if(null!==l&&void 0!==l&&0!==
l){n=W(l)+1;var v=X(n);T(l,v,n);n=v}return n},array:l=>{var n=X(l.length);y.set(l,n);return n}};a=d["_"+a];var h=[],g=0;if(e)for(var k=0;k<e.length;k++){var p=f[b[k]];p?(0===g&&(g=ka()),h[k]=p(e[k])):h[k]=e[k]}b=a(...h);return b=function(l){0!==g&&la(g);return"string"===c?l?V(z,l):"":"boolean"===c?!!l:l}(b)},oa=a=>{var c=W(a)+1,b=na(c);b&&T(a,b,c);return b};d.noExitRuntime&&(O=d.noExitRuntime);d.print&&(r=d.print);d.printErr&&(t=d.printErr);d.wasmBinary&&(u=d.wasmBinary);
if(d.preInit)for("function"==typeof d.preInit&&(d.preInit=[d.preInit]);0<d.preInit.length;)d.preInit.shift()();d.ccall=ma;d.cwrap=(a,c,b,e)=>{var f=!b||b.every(h=>"number"===h||"boolean"===h);return"string"!==c&&f&&!e?d["_"+a]:(...h)=>ma(a,c,b,h,e)};d.UTF8ToString=(a,c,b)=>a?V(z,a,c,b):"";d.stringToUTF8=(a,c,b)=>T(a,c,b);d.lengthBytesUTF8=W;d.allocateUTF8=(...a)=>oa(...a);
var na,pa,la,X,ka,F,qa={m:()=>G(""),l:()=>{O=!1;P=0},d:function(a,c){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);a=new Date(1E3*a);A[c>>2]=a.getSeconds();A[c+4>>2]=a.getMinutes();A[c+8>>2]=a.getHours();A[c+12>>2]=a.getDate();A[c+16>>2]=a.getMonth();A[c+20>>2]=a.getFullYear()-1900;A[c+24>>2]=a.getDay();var b=a.getFullYear();A[c+28>>2]=(0!==b%4||0===b%100&&0!==b%400?ha:fa)[a.getMonth()]+a.getDate()-1|0;A[c+36>>2]=-(60*a.getTimezoneOffset());b=(new Date(a.getFullYear(),6,1)).getTimezoneOffset();
var e=(new Date(a.getFullYear(),0,1)).getTimezoneOffset();A[c+32>>2]=(b!=e&&a.getTimezoneOffset()==Math.min(e,b))|0},n:(a,c)=>{Q[a]&&(clearTimeout(Q[a].id),delete Q[a]);if(!c)return 0;var b=setTimeout(()=>{delete Q[a];ia(()=>pa(a,performance.now()))},c);Q[a]={id:b,T:c};return 0},e:(a,c,b,e)=>{var f=(new Date).getFullYear(),h=(new Date(f,0,1)).getTimezoneOffset();f=(new Date(f,6,1)).getTimezoneOffset();B[a>>2]=60*Math.max(h,f);A[c>>2]=Number(h!=f);c=g=>{var k=Math.abs(g);return`UTC${0<=g?"-":"+"}${String(Math.floor(k/
60)).padStart(2,"0")}${String(k%60).padStart(2,"0")}`};a=c(h);c=c(f);f<h?(T(a,b,17),T(c,e,17)):(T(a,e,17),T(c,b,17))},i:function(a,c,b){if(!(0<=a&&3>=a))return 28;D[b>>3]=BigInt(Math.round(1E6*(0===a?Date.now():performance.now())));return 0},j:function(){if(!d.R)try{d.R=new (window.AudioContext||window.webkitAudioContext),d.S=[],console.log("TStorie Audio: Web Audio API initialized")}catch(a){console.error("TStorie Audio: Failed to initialize Web Audio API:",a)}},a:function(a,c,b,e){if(d.R){"suspended"===
d.R.state&&d.R.resume();try{if(!a||0>=c)console.error("TStorie Audio: Invalid audio data - dataPtr:",a,"length:",c);else if("undefined"===typeof C)console.error("TStorie Audio: HEAPF32 not available");else{var f=d.R.createBuffer(1,c,b),h=f.getChannelData(0);a>>=2;for(b=0;b<c;b++)h[b]=C[a+b];var g=d.R.createBufferSource(),k=d.R.createGain();g.buffer=f;k.gain.value=e;g.connect(k);k.connect(d.R.destination);d.S.push(g);g.onended=function(){const p=d.S.indexOf(g);-1<p&&d.S.splice(p,1)};g.start(0)}}catch(p){console.error("TStorie Audio: Error playing sample:",
p)}}else console.log("TStorie Audio: Audio context not initialized")},b:()=>Math.random(),o:a=>{var c=z.length;a>>>=0;if(2147483648<a)return!1;for(var b=1;4>=b;b*=2){var e=c*(1+.2/b);e=Math.min(e,a+100663296);a:{e=(Math.min(2147483648,65536*Math.ceil(Math.max(a,e)/65536))-F.buffer.byteLength+65535)/65536|0;try{F.grow(e);E();var f=1;break a}catch(h){}f=void 0}if(f)return!0}return!1},c:a=>{x=a;S(a)},g:()=>52,f:function(){return 70},h:(a,c,b,e)=>{for(var f=0,h=0;h<b;h++){var g=B[c>>2],k=B[c+4>>2];c+=
8;for(var p=0;p<k;p++){var l=a,n=z[g+p],v=ja[l];0===n||10===n?((1===l?r:t)(V(v)),v.length=0):v.push(n)}f+=k}B[e>>2]=f;return 0},k:S};
function Y(){function a(){d.calledRun=!0;if(!w){Z.q();d.onRuntimeInitialized?.();if(d.postRun)for("function"==typeof d.postRun&&(d.postRun=[d.postRun]);d.postRun.length;){var c=d.postRun.shift();K.push(c)}J(K)}}if(0<M)N=Y;else{if(d.preRun)for("function"==typeof d.preRun&&(d.preRun=[d.preRun]);d.preRun.length;)ea();J(L);0<M?N=Y:d.setStatus?(d.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>d.setStatus(""),1);a()},1)):a()}}var Z;
(async function(){function a(b){b=Z=b.exports;na=d._malloc=b.r;d._free=b.s;d._emInit=b.t;d._emUpdate=b.u;d._emResize=b.v;d._emGetCell=b.w;d._emGetCellFgR=b.x;d._emGetCellFgG=b.y;d._emGetCellFgB=b.z;d._emGetCellBgR=b.A;d._emGetCellBgG=b.B;d._emGetCellBgB=b.C;d._emGetCellBold=b.D;d._emGetCellItalic=b.E;d._emGetCellUnderline=b.F;d._emHandleKeyPress=b.G;d._emHandleTextInput=b.H;d._emHandleMouseClick=b.I;d._emHandleMouseRelease=b.J;d._emHandleMouseMove=b.K;d._emSetWaitingForGist=b.L;d._emLoadMarkdownFromJS=
b.M;pa=b.N;la=b.O;X=b.P;ka=b.Q;F=b.p;E();M--;d.monitorRunDependencies?.(M);0==M&&N&&(b=N,N=null,b());return Z}M++;d.monitorRunDependencies?.(M);var c={a:qa};if(d.instantiateWasm)return new Promise(b=>{d.instantiateWasm(c,(e,f)=>{b(a(e,f))})});H??=d.locateFile?d.locateFile("tstorie.wasm.wasm",m):m+"tstorie.wasm.wasm";return a((await da(c)).instance)})();Y();
