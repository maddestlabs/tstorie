/* Generated by Nim Compiler v2.2.6 */
/* Compiled for: Linux, wasm32, clang */
/* Command for C compiler:
   emcc -c -w -ferror-limit=3 -fno-strict-aliasing -sUSE_SDL=3 -Os   -I/home/codespace/.choosenim/toolchains/nim-2.2.6/lib -I/workspaces/telestorie -o /workspaces/telestorie/nimcache_wasm_core/@msrc@sappstate.nim.c.o /workspaces/telestorie/nimcache_wasm_core/@msrc@sappstate.nim.c */
#define NIM_INTBITS 32

#include "nimbase.h"
#include <stdlib.h>
#include <string.h>
#undef LANGUAGE_C
#undef MIPSEB
#undef MIPSEL
#undef PPC
#undef R3000
#undef R4000
#undef i386
#undef linux
#undef mips
#undef near
#undef far
#undef powerpc
#undef unix
typedef struct tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q;
typedef struct tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw;
typedef struct tySequence__hETDgeXECLenIIi9aRQgjOA tySequence__hETDgeXECLenIIi9aRQgjOA;
typedef struct tySequence__hETDgeXECLenIIi9aRQgjOA_Content tySequence__hETDgeXECLenIIi9aRQgjOA_Content;
typedef struct tySequence__yAQ9af4LrMfsCspWq9a5u6Og tySequence__yAQ9af4LrMfsCspWq9a5u6Og;
typedef struct tySequence__yAQ9af4LrMfsCspWq9a5u6Og_Content tySequence__yAQ9af4LrMfsCspWq9a5u6Og_Content;
typedef struct tyObject_Table__wHO9bxCEQsaOZ0Zzubt3C7Q tyObject_Table__wHO9bxCEQsaOZ0Zzubt3C7Q;
typedef struct tySequence__pUxI6Ljo6IKKHXKOZkQ7Og tySequence__pUxI6Ljo6IKKHXKOZkQ7Og;
typedef struct tySequence__pUxI6Ljo6IKKHXKOZkQ7Og_Content tySequence__pUxI6Ljo6IKKHXKOZkQ7Og_Content;
typedef struct tyObject_TerminalInputParser__GHUTtss0GjS80F0ZztO53Q tyObject_TerminalInputParser__GHUTtss0GjS80F0ZztO53Q;
typedef struct NimStrPayload NimStrPayload;
typedef struct NimStringV2 NimStringV2;
typedef struct tyObject_StringCsiState__yPPwgzKq9cCUo1gaKFHgn6w tyObject_StringCsiState__yPPwgzKq9cCUo1gaKFHgn6w;
typedef struct tyTuple__hSHiEU6uEtL7soi1F4tKCg tyTuple__hSHiEU6uEtL7soi1F4tKCg;
typedef struct tyObject_Table__wdMFxA8VBzcKe9cq9c9a9cPqMw tyObject_Table__wdMFxA8VBzcKe9cq9c9a9cPqMw;
typedef struct tySequence__9as8hCyx8WDhZXqXMf9bhgtA tySequence__9as8hCyx8WDhZXqXMf9bhgtA;
typedef struct tySequence__9as8hCyx8WDhZXqXMf9bhgtA_Content tySequence__9as8hCyx8WDhZXqXMf9bhgtA_Content;
typedef struct tyObject_LayercolonObjectType___GgVqgNTBauiDGOm9bCEWiYQ tyObject_LayercolonObjectType___GgVqgNTBauiDGOm9bCEWiYQ;
typedef struct tyObject_Cell__cmvwxiDU9cRtyqddD9c1iMTA tyObject_Cell__cmvwxiDU9cRtyqddD9c1iMTA;
typedef struct tyObject_Style__UURjArTrf2wmcCbN5MncAQ tyObject_Style__UURjArTrf2wmcCbN5MncAQ;
typedef struct tyObject_Color__TZLGUfQjHRBnaB3m3yIxqQ tyObject_Color__TZLGUfQjHRBnaB3m3yIxqQ;
typedef struct tyTuple__sr3s7uVHpu9cEbbDnCSg8yQ tyTuple__sr3s7uVHpu9cEbbDnCSg8yQ;
typedef struct tyTuple__9a36bWaF9cbmf9bDveJf6DOxA tyTuple__9a36bWaF9cbmf9bDveJf6DOxA;
typedef struct tyObject_StyleConfig__9bjh0AGgwfTanQXGeML3y9aA tyObject_StyleConfig__9bjh0AGgwfTanQXGeML3y9aA;
struct tySequence__hETDgeXECLenIIi9aRQgjOA {
  NI len; tySequence__hETDgeXECLenIIi9aRQgjOA_Content* p;
};
struct tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw {
	NI width;
	NI height;
	tySequence__hETDgeXECLenIIi9aRQgjOA cells;
	NI clipX;
	NI clipY;
	NI clipW;
	NI clipH;
	NI offsetX;
	NI offsetY;
};
struct tySequence__yAQ9af4LrMfsCspWq9a5u6Og {
  NI len; tySequence__yAQ9af4LrMfsCspWq9a5u6Og_Content* p;
};
struct tySequence__pUxI6Ljo6IKKHXKOZkQ7Og {
  NI len; tySequence__pUxI6Ljo6IKKHXKOZkQ7Og_Content* p;
};
struct tyObject_Table__wHO9bxCEQsaOZ0Zzubt3C7Q {
	tySequence__pUxI6Ljo6IKKHXKOZkQ7Og data;
	NI counter;
};
struct NimStrPayload {
	NI cap;
	NIM_CHAR data[SEQ_DECL_SIZE];
};
struct NimStringV2 {
	NI len;
	NimStrPayload* p;
};
typedef NU8 tyEnum_ParserState__6PLEBin7h1EQimLs0bNQ8Q;
typedef NIM_CHAR tyArray__Wfh9bjgBQ4UqJsyISUuDSuA[16];
typedef NI64 tyArray__OVZLCdT9cxlVUwpPH2Dz8OA[16];
struct tyObject_StringCsiState__yPPwgzKq9cCUo1gaKFHgn6w {
	NI leaderlen;
	tyArray__Wfh9bjgBQ4UqJsyISUuDSuA leader;
	NI argi;
	tyArray__OVZLCdT9cxlVUwpPH2Dz8OA args;
};
struct tyObject_TerminalInputParser__GHUTtss0GjS80F0ZztO53Q {
	NIM_BOOL prevEsc;
	NIM_BOOL inEsc;
	NIM_BOOL inEscO;
	NIM_BOOL inUtf8;
	NI utf8Remaining;
	NimStringV2 utf8Buffer;
	tyEnum_ParserState__6PLEBin7h1EQimLs0bNQ8Q state;
	tyObject_StringCsiState__yPPwgzKq9cCUo1gaKFHgn6w csi;
	NI intermedlen;
	tyArray__Wfh9bjgBQ4UqJsyISUuDSuA intermed;
	NI mouseCol;
	NI mouseRow;
	NI width;
	NI height;
	NF escTimer;
	NIM_BOOL endedInEsc;
	NIM_BOOL enableEscapeTimeout;
	NI escapeTimeout;
	NIM_BOOL mouseTrackingDisabled;
	NF mouseTrackingReenableTime;
};
struct tyTuple__hSHiEU6uEtL7soi1F4tKCg {
	NU8 Field0;
	NU8 Field1;
	NU8 Field2;
};
struct tySequence__9as8hCyx8WDhZXqXMf9bhgtA {
  NI len; tySequence__9as8hCyx8WDhZXqXMf9bhgtA_Content* p;
};
struct tyObject_Table__wdMFxA8VBzcKe9cq9c9a9cPqMw {
	tySequence__9as8hCyx8WDhZXqXMf9bhgtA data;
	NI counter;
};
struct tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q {
	NIM_BOOL running;
	NI termWidth;
	NI termHeight;
	tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw currentBuffer;
	tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw previousBuffer;
	NI frameCount;
	NF totalTime;
	NF fps;
	NF lastFpsUpdate;
	NF targetFps;
	NI colorSupport;
	tySequence__yAQ9af4LrMfsCspWq9a5u6Og layers;
	tyObject_Table__wHO9bxCEQsaOZ0Zzubt3C7Q layerIndexCache;
	NIM_BOOL cacheValid;
	tyObject_TerminalInputParser__GHUTtss0GjS80F0ZztO53Q inputParser;
	NI lastMouseX;
	NI lastMouseY;
	void* audioSystemPtr;
	tyTuple__hSHiEU6uEtL7soi1F4tKCg themeBackground;
	tyObject_Table__wdMFxA8VBzcKe9cq9c9a9cPqMw styleSheet;
};
typedef NimStringV2 tyArray__sMpvt1sOxOJ3LFGulnbeMQ[4];
typedef NimStringV2 tyArray__nHXaesL0DJZHyVS07ARPRA[1];
struct tyObject_Color__TZLGUfQjHRBnaB3m3yIxqQ {
	NU8 r;
	NU8 g;
	NU8 b;
};
struct tyObject_Style__UURjArTrf2wmcCbN5MncAQ {
	tyObject_Color__TZLGUfQjHRBnaB3m3yIxqQ fg;
	tyObject_Color__TZLGUfQjHRBnaB3m3yIxqQ bg;
	NIM_BOOL bold;
	NIM_BOOL underline;
	NIM_BOOL italic;
	NIM_BOOL dim;
};
struct tyObject_Cell__cmvwxiDU9cRtyqddD9c1iMTA {
	NimStringV2 ch;
	tyObject_Style__UURjArTrf2wmcCbN5MncAQ style;
};
struct tySequence__hETDgeXECLenIIi9aRQgjOA_Content { NI cap; tyObject_Cell__cmvwxiDU9cRtyqddD9c1iMTA data[SEQ_DECL_SIZE]; };
struct tySequence__yAQ9af4LrMfsCspWq9a5u6Og_Content { NI cap; tyObject_LayercolonObjectType___GgVqgNTBauiDGOm9bCEWiYQ* data[SEQ_DECL_SIZE]; };
struct tyTuple__sr3s7uVHpu9cEbbDnCSg8yQ {
	NI Field0;
	NimStringV2 Field1;
	NI Field2;
};
struct tySequence__pUxI6Ljo6IKKHXKOZkQ7Og_Content { NI cap; tyTuple__sr3s7uVHpu9cEbbDnCSg8yQ data[SEQ_DECL_SIZE]; };
struct tyObject_StyleConfig__9bjh0AGgwfTanQXGeML3y9aA {
	tyTuple__hSHiEU6uEtL7soi1F4tKCg fg;
	tyTuple__hSHiEU6uEtL7soi1F4tKCg bg;
	NIM_BOOL bold;
	NIM_BOOL italic;
	NIM_BOOL underline;
	NIM_BOOL dim;
};
struct tyTuple__9a36bWaF9cbmf9bDveJf6DOxA {
	NI Field0;
	NimStringV2 Field1;
	tyObject_StyleConfig__9bjh0AGgwfTanQXGeML3y9aA Field2;
};
struct tySequence__9as8hCyx8WDhZXqXMf9bhgtA_Content { NI cap; tyTuple__9a36bWaF9cbmf9bDveJf6DOxA data[SEQ_DECL_SIZE]; };
N_LIB_PRIVATE N_NIMCALL(NimStringV2, dollar___systemZdollars_u14)(NI xX60gensym0__p0);
N_LIB_PRIVATE N_NIMCALL(void, echoBinSafe)(NimStringV2* args_p0, NI args_p0Len_0);
static N_INLINE(void, quit__system_u6369)(NI errorcode_p0);
N_LIB_PRIVATE N_NIMCALL(void, eqsink___srcZlayers_u25)(tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw* dest_p0, tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw* src_p1);
N_LIB_PRIVATE N_NIMCALL(void, newTermBuffer__backendsZterminalZtermbuffer_u4)(NI w_p0, NI h_p1, tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw* Result);
static N_INLINE(void, nimZeroMem)(void* p_p0, NI size_p1);
static N_INLINE(void, nimSetMem__systemZmemory_u7)(void* a_p0, int v_p1, NI size_p2);
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void);
N_LIB_PRIVATE N_NIMCALL(void, resizeLayers__srcZlayers_u2334)(tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q* state_p0, NI newWidth_p1, NI newHeight_p2);
N_LIB_PRIVATE N_NOCONV(void, dealloc)(void* p_p0);
N_LIB_PRIVATE N_NOINLINE(void, raiseOverflow)(void);
static N_INLINE(void, pluseq___pureZstrutils_u2603)(NF* x_p0, NF y_p1);
N_LIB_PRIVATE N_NIMCALL(tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q*, new__srcZappstate_u7)(void);
N_LIB_PRIVATE N_NIMCALL(void, eqsink___srcZlayers_u1846)(tySequence__yAQ9af4LrMfsCspWq9a5u6Og* dest_p0, tySequence__yAQ9af4LrMfsCspWq9a5u6Og src_p1);
N_LIB_PRIVATE N_NIMCALL(void*, newSeqPayload)(NI cap_p0, NI elemSize_p1, NI elemAlign_p2);
N_LIB_PRIVATE N_NIMCALL(void, eqsink___srcZappstate_u343)(tyObject_TerminalInputParser__GHUTtss0GjS80F0ZztO53Q* dest_p0, tyObject_TerminalInputParser__GHUTtss0GjS80F0ZztO53Q* src_p1);
N_LIB_PRIVATE N_NIMCALL(void, newTerminalInputParser__srcZinput_u370)(tyObject_TerminalInputParser__GHUTtss0GjS80F0ZztO53Q* Result);
static const struct {
  NI cap; NIM_CHAR data[36+1];
} TM__q7pryhnR86ABMsp6089b69bw_2 = { 36 | NIM_STRLIT_FLAG, "[AppState] resizeState called with: " };
static const NimStringV2 TM__q7pryhnR86ABMsp6089b69bw_3 = {36, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_2};
static const struct {
  NI cap; NIM_CHAR data[1+1];
} TM__q7pryhnR86ABMsp6089b69bw_4 = { 1 | NIM_STRLIT_FLAG, "x" };
static const NimStringV2 TM__q7pryhnR86ABMsp6089b69bw_5 = {1, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_4};
static const struct {
  NI cap; NIM_CHAR data[62+1];
} TM__q7pryhnR86ABMsp6089b69bw_7 = { 62 | NIM_STRLIT_FLAG, "[AppState] ERROR: resizeState called with negative dimensions!" };
static const struct {
  NI cap; NIM_CHAR data[31+1];
} TM__q7pryhnR86ABMsp6089b69bw_9 = { 31 | NIM_STRLIT_FLAG, "[AppState] resizeState complete" };
static const struct {
  NI cap; NIM_CHAR data[37+1];
} TM__q7pryhnR86ABMsp6089b69bw_11 = { 37 | NIM_STRLIT_FLAG, "[AppState] Creating with dimensions: " };
static const NimStringV2 TM__q7pryhnR86ABMsp6089b69bw_12 = {37, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_11};
static const NimStringV2 TM__q7pryhnR86ABMsp6089b69bw_13 = {1, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_4};
static const struct {
  NI cap; NIM_CHAR data[35+1];
} TM__q7pryhnR86ABMsp6089b69bw_14 = { 35 | NIM_STRLIT_FLAG, "[AppState] Creating currentBuffer: " };
static const NimStringV2 TM__q7pryhnR86ABMsp6089b69bw_15 = {35, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_14};
static const NimStringV2 TM__q7pryhnR86ABMsp6089b69bw_16 = {1, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_4};
static const struct {
  NI cap; NIM_CHAR data[36+1];
} TM__q7pryhnR86ABMsp6089b69bw_17 = { 36 | NIM_STRLIT_FLAG, "[AppState] Creating previousBuffer: " };
static const NimStringV2 TM__q7pryhnR86ABMsp6089b69bw_18 = {36, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_17};
static const NimStringV2 TM__q7pryhnR86ABMsp6089b69bw_19 = {1, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_4};
static const struct {
  NI cap; NIM_CHAR data[39+1];
} TM__q7pryhnR86ABMsp6089b69bw_21 = { 39 | NIM_STRLIT_FLAG, "[AppState] Buffers created successfully" };
static NIM_CONST tyArray__nHXaesL0DJZHyVS07ARPRA TM__q7pryhnR86ABMsp6089b69bw_6 = {{62, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_7}}
;
static NIM_CONST tyArray__nHXaesL0DJZHyVS07ARPRA TM__q7pryhnR86ABMsp6089b69bw_8 = {{31, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_9}}
;
static NIM_CONST tyArray__nHXaesL0DJZHyVS07ARPRA TM__q7pryhnR86ABMsp6089b69bw_20 = {{39, (NimStrPayload*)&TM__q7pryhnR86ABMsp6089b69bw_21}}
;
extern NIM_BOOL nimInErrorMode__system_u4234;
N_LIB_PRIVATE N_NIMCALL(void, setTargetFps__srcZappstate_u373)(tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q* state_p0, NF fps_p1) {
	(*state_p0).targetFps = fps_p1;
}
static N_INLINE(void, quit__system_u6369)(NI errorcode_p0) {
	{
		if (!(errorcode_p0 < ((NI)-128))) goto LA3_;
		exit(((int)-128));
	}
	goto LA1_;
LA3_: ;
	{
		if (!(((NI)127) < errorcode_p0)) goto LA6_;
		exit(((int)127));
	}
	goto LA1_;
LA6_: ;
	{
		exit(((int) (errorcode_p0)));
	}
LA1_: ;
}
static N_INLINE(void, nimSetMem__systemZmemory_u7)(void* a_p0, int v_p1, NI size_p2) {
	void* T1_;
	T1_ = (void*)0;
	T1_ = memset(a_p0, v_p1, ((size_t) (size_p2)));
}
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void) {
	NIM_BOOL* result;
	result = (&nimInErrorMode__system_u4234);
	return result;
}
static N_INLINE(void, nimZeroMem)(void* p_p0, NI size_p1) {
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	nimSetMem__systemZmemory_u7(p_p0, ((int)0), size_p1);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
}
N_LIB_PRIVATE N_NIMCALL(void, resizeState__srcZappstate_u396)(tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q* state_p0, NI newWidth_p1, NI newHeight_p2) {
	NimStringV2 colontmpD_;
	NimStringV2 colontmpD__2;
	tyArray__sMpvt1sOxOJ3LFGulnbeMQ T2_;
	tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw T9_;
	tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw T10_;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	colontmpD_.len = 0; colontmpD_.p = NIM_NIL;
	colontmpD__2.len = 0; colontmpD__2.p = NIM_NIL;
	T2_[0] = TM__q7pryhnR86ABMsp6089b69bw_3;
	colontmpD_ = dollar___systemZdollars_u14(newWidth_p1);
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	T2_[1] = colontmpD_;
	T2_[2] = TM__q7pryhnR86ABMsp6089b69bw_5;
	colontmpD__2 = dollar___systemZdollars_u14(newHeight_p2);
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	T2_[3] = colontmpD__2;
	echoBinSafe(T2_, 4);
	{
		NIM_BOOL T5_;
		T5_ = (NIM_BOOL)0;
		T5_ = (newWidth_p1 < ((NI)0));
		if (T5_) goto LA6_;
		T5_ = (newHeight_p2 < ((NI)0));
LA6_: ;
		if (!T5_) goto LA7_;
		echoBinSafe(TM__q7pryhnR86ABMsp6089b69bw_6, 1);
		quit__system_u6369(((NI)1));
	}
LA7_: ;
	(*state_p0).termWidth = newWidth_p1;
	(*state_p0).termHeight = newHeight_p2;
	nimZeroMem((void*)(&T9_), sizeof(tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw));
	newTermBuffer__backendsZterminalZtermbuffer_u4(newWidth_p1, newHeight_p2, (&T9_));
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	eqsink___srcZlayers_u25((&(*state_p0).currentBuffer), (&T9_));
	nimZeroMem((void*)(&T10_), sizeof(tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw));
	newTermBuffer__backendsZterminalZtermbuffer_u4(newWidth_p1, newHeight_p2, (&T10_));
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	eqsink___srcZlayers_u25((&(*state_p0).previousBuffer), (&T10_));
	resizeLayers__srcZlayers_u2334(state_p0, newWidth_p1, newHeight_p2);
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	echoBinSafe(TM__q7pryhnR86ABMsp6089b69bw_8, 1);
	{
		LA1_:;
	}
	{
		if (colontmpD__2.p && !(colontmpD__2.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD__2.p);
}
		if (colontmpD_.p && !(colontmpD_.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD_.p);
}
	}
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
}
static N_INLINE(void, pluseq___pureZstrutils_u2603)(NF* x_p0, NF y_p1) {
	(*x_p0) = ((NF)((*x_p0)) + (NF)(y_p1));
}
N_LIB_PRIVATE N_NIMCALL(void, updateFpsCounter__srcZappstate_u376)(tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q* state_p0, NF deltaTime_p1) {
	NI TM__q7pryhnR86ABMsp6089b69bw_10;
{	if (nimAddInt((*state_p0).frameCount, ((NI)1), &TM__q7pryhnR86ABMsp6089b69bw_10)) { raiseOverflow(); goto BeforeRet_;
	};
	(*state_p0).frameCount = (NI)(TM__q7pryhnR86ABMsp6089b69bw_10);
	pluseq___pureZstrutils_u2603((&(*state_p0).totalTime), deltaTime_p1);
	{
		if (!(0.5 <= ((NF)((*state_p0).totalTime) - (NF)((*state_p0).lastFpsUpdate)))) goto LA3_;
		(*state_p0).fps = ((NF)(1.0) / (NF)(deltaTime_p1));
		(*state_p0).lastFpsUpdate = (*state_p0).totalTime;
	}
LA3_: ;
	}BeforeRet_: ;
}
N_LIB_PRIVATE N_NIMCALL(tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q*, newAppState__srcZappstate_u3)(NI width_p0, NI height_p1) {
	tyObject_AppStatecolonObjectType___jrSyZ9aZLwUQnIb5lEtzv8Q* result;
	NimStringV2 colontmpD_;
	NimStringV2 colontmpD__2;
	NimStringV2 colontmpD__3;
	NimStringV2 colontmpD__4;
	NimStringV2 colontmpD__5;
	NimStringV2 colontmpD__6;
	tyArray__sMpvt1sOxOJ3LFGulnbeMQ T2_;
	tyArray__sMpvt1sOxOJ3LFGulnbeMQ T3_;
	tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw T4_;
	tyArray__sMpvt1sOxOJ3LFGulnbeMQ T5_;
	tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw T6_;
	tySequence__yAQ9af4LrMfsCspWq9a5u6Og T7_;
	tyObject_TerminalInputParser__GHUTtss0GjS80F0ZztO53Q T8_;
	NU8 colontmp_;
	NU8 colontmp__2;
	NU8 colontmp__3;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = NIM_NIL;
	colontmpD_.len = 0; colontmpD_.p = NIM_NIL;
	colontmpD__2.len = 0; colontmpD__2.p = NIM_NIL;
	colontmpD__3.len = 0; colontmpD__3.p = NIM_NIL;
	colontmpD__4.len = 0; colontmpD__4.p = NIM_NIL;
	colontmpD__5.len = 0; colontmpD__5.p = NIM_NIL;
	colontmpD__6.len = 0; colontmpD__6.p = NIM_NIL;
	T2_[0] = TM__q7pryhnR86ABMsp6089b69bw_12;
	colontmpD_ = dollar___systemZdollars_u14(width_p0);
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	T2_[1] = colontmpD_;
	T2_[2] = TM__q7pryhnR86ABMsp6089b69bw_13;
	colontmpD__2 = dollar___systemZdollars_u14(height_p1);
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	T2_[3] = colontmpD__2;
	echoBinSafe(T2_, 4);
	result = new__srcZappstate_u7();
	(*result).termWidth = width_p0;
	(*result).termHeight = height_p1;
	T3_[0] = TM__q7pryhnR86ABMsp6089b69bw_15;
	colontmpD__3 = dollar___systemZdollars_u14(width_p0);
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	T3_[1] = colontmpD__3;
	T3_[2] = TM__q7pryhnR86ABMsp6089b69bw_16;
	colontmpD__4 = dollar___systemZdollars_u14(height_p1);
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	T3_[3] = colontmpD__4;
	echoBinSafe(T3_, 4);
	nimZeroMem((void*)(&T4_), sizeof(tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw));
	newTermBuffer__backendsZterminalZtermbuffer_u4(width_p0, height_p1, (&T4_));
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	eqsink___srcZlayers_u25((&(*result).currentBuffer), (&T4_));
	T5_[0] = TM__q7pryhnR86ABMsp6089b69bw_18;
	colontmpD__5 = dollar___systemZdollars_u14(width_p0);
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	T5_[1] = colontmpD__5;
	T5_[2] = TM__q7pryhnR86ABMsp6089b69bw_19;
	colontmpD__6 = dollar___systemZdollars_u14(height_p1);
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	T5_[3] = colontmpD__6;
	echoBinSafe(T5_, 4);
	nimZeroMem((void*)(&T6_), sizeof(tyObject_TermBuffer__a0me0i7S30c79coeAcFBkWw));
	newTermBuffer__backendsZterminalZtermbuffer_u4(width_p0, height_p1, (&T6_));
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	eqsink___srcZlayers_u25((&(*result).previousBuffer), (&T6_));
	echoBinSafe(TM__q7pryhnR86ABMsp6089b69bw_20, 1);
	(*result).colorSupport = ((NI)16777216);
	(*result).running = NIM_TRUE;
	T7_.len = 0; T7_.p = NIM_NIL;
	T7_.len = 0; T7_.p = (tySequence__yAQ9af4LrMfsCspWq9a5u6Og_Content*) newSeqPayload(0, sizeof(tyObject_LayercolonObjectType___GgVqgNTBauiDGOm9bCEWiYQ*), NIM_ALIGNOF(tyObject_LayercolonObjectType___GgVqgNTBauiDGOm9bCEWiYQ*));
	eqsink___srcZlayers_u1846((&(*result).layers), T7_);
	(*result).targetFps = 60.0;
	nimZeroMem((void*)(&T8_), sizeof(tyObject_TerminalInputParser__GHUTtss0GjS80F0ZztO53Q));
	newTerminalInputParser__srcZinput_u370((&T8_));
	if (NIM_UNLIKELY(*nimErr_)) goto LA1_;
	eqsink___srcZappstate_u343((&(*result).inputParser), (&T8_));
	(*result).lastMouseX = ((NI)0);
	(*result).lastMouseY = ((NI)0);
	(*result).fps = 60.0;
	(*result).frameCount = ((NI)0);
	(*result).totalTime = 0.0;
	(*result).lastFpsUpdate = 0.0;
	(*result).audioSystemPtr = NIM_NIL;
	colontmp_ = ((NU8)0);
	colontmp__2 = ((NU8)0);
	colontmp__3 = ((NU8)0);
	(*result).themeBackground.Field0 = colontmp_;
	(*result).themeBackground.Field1 = colontmp__2;
	(*result).themeBackground.Field2 = colontmp__3;
	{
		LA1_:;
	}
	{
		if (colontmpD__6.p && !(colontmpD__6.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD__6.p);
}
		if (colontmpD__5.p && !(colontmpD__5.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD__5.p);
}
		if (colontmpD__4.p && !(colontmpD__4.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD__4.p);
}
		if (colontmpD__3.p && !(colontmpD__3.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD__3.p);
}
		if (colontmpD__2.p && !(colontmpD__2.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD__2.p);
}
		if (colontmpD_.p && !(colontmpD_.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD_.p);
}
	}
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}
