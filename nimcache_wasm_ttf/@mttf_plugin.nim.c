/* Generated by Nim Compiler v2.2.6 */
/* Compiled for: Linux, wasm32, clang */
/* Command for C compiler:
   emcc -c -w -ferror-limit=3 -fno-strict-aliasing -fPIC -sUSE_SDL=3 -I/workspaces/storie-vendor/vendor/SDL_ttf-src/include -Os   -I/home/codespace/.choosenim/toolchains/nim-2.2.6/lib -I/workspaces/telestorie -o /workspaces/telestorie/nimcache_wasm_ttf/@mttf_plugin.nim.c.o /workspaces/telestorie/nimcache_wasm_ttf/@mttf_plugin.nim.c */
#define NIM_INTBITS 32

#include "nimbase.h"
#include "SDL3_ttf/SDL_ttf.h"
#include "SDL3/SDL_pixels.h"
#include <string.h>
#include "SDL3/SDL_surface.h"
#include "SDL3/SDL_render.h"
#include "SDL3/SDL_rect.h"
#include "SDL3/SDL.h"
#undef LANGUAGE_C
#undef MIPSEB
#undef MIPSEL
#undef PPC
#undef R3000
#undef R4000
#undef i386
#undef linux
#undef mips
#undef near
#undef far
#undef powerpc
#undef unix
typedef struct NimStrPayload NimStrPayload;
typedef struct NimStringV2 NimStringV2;
struct NimStrPayload {
	NI cap;
	NIM_CHAR data[SEQ_DECL_SIZE];
};
struct NimStringV2 {
	NI len;
	NimStrPayload* p;
};
typedef NimStringV2 tyArray__nHXaesL0DJZHyVS07ARPRA[1];
typedef NimStringV2 tyArray__Re75IspeoxXy2oCZHwcRrA[2];
N_LIB_EXPORT N_CDECL(NIM_BOOL, ttfInitPlugin)(void);
N_LIB_PRIVATE N_NIMCALL(void, echoBinSafe)(NimStringV2* args_p0, NI args_p0Len_0);
N_LIB_EXPORT N_CDECL(void*, ttfGetFontHandle)(void);
N_LIB_EXPORT N_CDECL(NIM_BOOL, ttfRenderText)(SDL_Renderer* renderer_p0, void* fontHandle_p1, NCSTRING text_p2, float x_p3, float y_p4, NU8 r_p5, NU8 g_p6, NU8 b_p7);
N_LIB_PRIVATE N_NOCONV(void, dealloc)(void* p_p0);
static N_INLINE(void, nimZeroMem)(void* p_p0, NI size_p1);
static N_INLINE(void, nimSetMem__systemZmemory_u7)(void* a_p0, int v_p1, NI size_p2);
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void);
N_LIB_PRIVATE N_NIMCALL(NimStringV2, cstrToNimstr)(NCSTRING str_p0);
N_LIB_PRIVATE N_NIMCALL(void, nimTestErrorFlag)(void);
N_LIB_PRIVATE N_NIMCALL(void, atpsystemdotnim_Init000)(void);
N_LIB_PRIVATE N_NIMCALL(void, NimMainModule)(void);
static const struct {
  NI cap; NIM_CHAR data[28+1];
} TM__zR42cqKtTXUcXGTOpHk4dw_3 = { 28 | NIM_STRLIT_FLAG, "[TTF Plugin] Initializing..." };
static const struct {
  NI cap; NIM_CHAR data[32+1];
} TM__zR42cqKtTXUcXGTOpHk4dw_5 = { 32 | NIM_STRLIT_FLAG, "[TTF Plugin] Already initialized" };
static const struct {
  NI cap; NIM_CHAR data[41+1];
} TM__zR42cqKtTXUcXGTOpHk4dw_7 = { 41 | NIM_STRLIT_FLAG, "[TTF Plugin] Failed to initialize SDL_ttf" };
static const struct {
  NI cap; NIM_CHAR data[39+1];
} TM__zR42cqKtTXUcXGTOpHk4dw_9 = { 39 | NIM_STRLIT_FLAG, "[TTF Plugin] Failed to load font from: " };
static const struct {
  NI cap; NIM_CHAR data[37+1];
} TM__zR42cqKtTXUcXGTOpHk4dw_10 = { 37 | NIM_STRLIT_FLAG, "/fonts/KodeMono-VariableFont_wght.ttf" };
static const struct {
  NI cap; NIM_CHAR data[39+1];
} TM__zR42cqKtTXUcXGTOpHk4dw_12 = { 39 | NIM_STRLIT_FLAG, "[TTF Plugin] Font loaded successfully: " };
static NIM_CONST tyArray__nHXaesL0DJZHyVS07ARPRA TM__zR42cqKtTXUcXGTOpHk4dw_2 = {{28, (NimStrPayload*)&TM__zR42cqKtTXUcXGTOpHk4dw_3}}
;
static NIM_CONST tyArray__nHXaesL0DJZHyVS07ARPRA TM__zR42cqKtTXUcXGTOpHk4dw_4 = {{32, (NimStrPayload*)&TM__zR42cqKtTXUcXGTOpHk4dw_5}}
;
static NIM_CONST tyArray__nHXaesL0DJZHyVS07ARPRA TM__zR42cqKtTXUcXGTOpHk4dw_6 = {{41, (NimStrPayload*)&TM__zR42cqKtTXUcXGTOpHk4dw_7}}
;
static NIM_CONST tyArray__Re75IspeoxXy2oCZHwcRrA TM__zR42cqKtTXUcXGTOpHk4dw_8 = {{39, (NimStrPayload*)&TM__zR42cqKtTXUcXGTOpHk4dw_9},
{37, (NimStrPayload*)&TM__zR42cqKtTXUcXGTOpHk4dw_10}}
;
static NIM_CONST tyArray__Re75IspeoxXy2oCZHwcRrA TM__zR42cqKtTXUcXGTOpHk4dw_11 = {{39, (NimStrPayload*)&TM__zR42cqKtTXUcXGTOpHk4dw_12},
{37, (NimStrPayload*)&TM__zR42cqKtTXUcXGTOpHk4dw_10}}
;
N_LIB_PRIVATE TTF_Font* gPluginFont__ttf95plugin_u5 = ((TTF_Font*) NIM_NIL);
N_LIB_PRIVATE NIM_BOOL gPluginInitialized__ttf95plugin_u6 = NIM_FALSE;
extern NIM_BOOL nimInErrorMode__system_u4234;
N_LIB_EXPORT N_CDECL(NIM_BOOL, ttfInitPlugin)(void) {
	NIM_BOOL result;
{	result = (NIM_BOOL)0;
	echoBinSafe(TM__zR42cqKtTXUcXGTOpHk4dw_2, 1);
	{
		if (!gPluginInitialized__ttf95plugin_u6) goto LA3_;
		echoBinSafe(TM__zR42cqKtTXUcXGTOpHk4dw_4, 1);
		result = NIM_TRUE;
		goto BeforeRet_;
	}
LA3_: ;
	{
		NIM_BOOL T7_;
		T7_ = (NIM_BOOL)0;
		T7_ = TTF_Init();
		if (!!(T7_)) goto LA8_;
		echoBinSafe(TM__zR42cqKtTXUcXGTOpHk4dw_6, 1);
		result = NIM_FALSE;
		goto BeforeRet_;
	}
LA8_: ;
	gPluginFont__ttf95plugin_u5 = TTF_OpenFont("/fonts/KodeMono-VariableFont_wght.ttf", 14.0f);
	{
		if (!(gPluginFont__ttf95plugin_u5 == 0)) goto LA12_;
		echoBinSafe(TM__zR42cqKtTXUcXGTOpHk4dw_8, 2);
		result = NIM_FALSE;
		goto BeforeRet_;
	}
LA12_: ;
	echoBinSafe(TM__zR42cqKtTXUcXGTOpHk4dw_11, 2);
	gPluginInitialized__ttf95plugin_u6 = NIM_TRUE;
	result = NIM_TRUE;
	goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}
N_LIB_EXPORT N_CDECL(void*, ttfGetFontHandle)(void) {
	void* result;
{	result = ((void*) (gPluginFont__ttf95plugin_u5));
	goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}
static N_INLINE(void, nimSetMem__systemZmemory_u7)(void* a_p0, int v_p1, NI size_p2) {
	void* T1_;
	T1_ = (void*)0;
	T1_ = memset(a_p0, v_p1, ((size_t) (size_p2)));
}
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void) {
	NIM_BOOL* result;
	result = (&nimInErrorMode__system_u4234);
	return result;
}
static N_INLINE(void, nimZeroMem)(void* p_p0, NI size_p1) {
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	nimSetMem__systemZmemory_u7(p_p0, ((int)0), size_p1);
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
}
N_LIB_EXPORT N_CDECL(NIM_BOOL, ttfRenderText)(SDL_Renderer* renderer_p0, void* fontHandle_p1, NCSTRING text_p2, float x_p3, float y_p4, NU8 r_p5, NU8 g_p6, NU8 b_p7) {
	NIM_BOOL result;
	NimStringV2 colontmpD_;
	TTF_Font* font_1;
	SDL_Color color_1;
	size_t textLen_1;
	SDL_Surface* surface_1;
	float w_1;
	float h_1;
	SDL_Texture* texture_1;
	SDL_FRect dstRect_1;
	NIM_BOOL success_1;
NIM_BOOL* nimErr_;
{nimErr_ = nimErrorFlag();
	result = (NIM_BOOL)0;
	colontmpD_.len = 0; colontmpD_.p = NIM_NIL;
	{
		NIM_BOOL T4_;
		T4_ = (NIM_BOOL)0;
		T4_ = (fontHandle_p1 == 0);
		if (T4_) goto LA5_;
		T4_ = (text_p2 == 0);
LA5_: ;
		if (!T4_) goto LA6_;
		result = NIM_FALSE;
		if (colontmpD_.p && !(colontmpD_.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD_.p);
}
		goto BeforeRet_;
	}
LA6_: ;
	font_1 = ((TTF_Font*) (fontHandle_p1));
	nimZeroMem((void*)(&color_1), sizeof(SDL_Color));
	color_1.r = r_p5;
	color_1.g = g_p6;
	color_1.b = b_p7;
	color_1.a = ((NU8)255);
	colontmpD_ = cstrToNimstr(text_p2);
	textLen_1 = ((size_t) (colontmpD_.len));
	surface_1 = TTF_RenderText_Blended(font_1, text_p2, textLen_1, color_1);
	{
		if (!(surface_1 == 0)) goto LA10_;
		result = NIM_FALSE;
		if (colontmpD_.p && !(colontmpD_.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD_.p);
}
		goto BeforeRet_;
	}
LA10_: ;
	w_1 = ((float) ((*surface_1).w));
	h_1 = ((float) ((*surface_1).h));
	texture_1 = SDL_CreateTextureFromSurface(renderer_p0, surface_1);
	SDL_DestroySurface(surface_1);
	{
		if (!(texture_1 == 0)) goto LA14_;
		result = NIM_FALSE;
		if (colontmpD_.p && !(colontmpD_.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD_.p);
}
		goto BeforeRet_;
	}
LA14_: ;
	nimZeroMem((void*)(&dstRect_1), sizeof(SDL_FRect));
	dstRect_1.x = x_p3;
	dstRect_1.y = y_p4;
	dstRect_1.w = w_1;
	dstRect_1.h = h_1;
	success_1 = SDL_RenderTexture(renderer_p0, texture_1, ((SDL_FRect*) NIM_NIL), (&dstRect_1));
	SDL_DestroyTexture(texture_1);
	result = success_1;
	if (colontmpD_.p && !(colontmpD_.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD_.p);
}
	goto BeforeRet_;
	{
		LA1_:;
	}
	{
		if (colontmpD_.p && !(colontmpD_.p->cap & NIM_STRLIT_FLAG)) {
 dealloc(colontmpD_.p);
}
	}
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	}BeforeRet_: ;
	return result;
}

N_LIB_PRIVATE void PreMainInner(void) {
}

N_LIB_PRIVATE int cmdCount;
N_LIB_PRIVATE char** cmdLine;
N_LIB_PRIVATE char** gEnv;
N_LIB_PRIVATE void PreMain(void) {
#if 0
	void (*volatile inner)(void);
	inner = PreMainInner;
	atpsystemdotnim_Init000();
	(*inner)();
#else
	atpsystemdotnim_Init000();
	PreMainInner();
#endif
}

N_LIB_PRIVATE N_CDECL(void, NimMainInner)(void) {
	NimMainModule();
}

N_CDECL(void, NimMain)(void) {
#if 0
	void (*volatile inner)(void);
	PreMain();
	inner = NimMainInner;
	(*inner)();
#else
	PreMain();
	NimMainInner();
#endif
}

int main(int argc, char** args, char** env) {
	cmdLine = args;
	cmdCount = argc;
	gEnv = env;
	NimMain();
	return nim_program_result;
}

N_LIB_PRIVATE N_NIMCALL(void, NimMainModule)(void) {
{
	NIM_BOOL T1_;
NIM_BOOL* nimErr_;
nimErr_ = nimErrorFlag();
	T1_ = (NIM_BOOL)0;
	T1_ = ttfInitPlugin();
	if (NIM_UNLIKELY(*nimErr_)) goto BeforeRet_;
	(void)(T1_);
	BeforeRet_: ;
	nimTestErrorFlag();
}
}

